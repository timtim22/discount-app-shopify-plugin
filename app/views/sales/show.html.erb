<br/>
<section>
  <article>
    <div class="card">
      <p>
        <strong>Status:</strong>
        <%= @sale.status %>
      </p>

      <p>
        <strong>Title:</strong>
        <%= @sale.title %>
      </p>

      <p>
        <strong>Amount:</strong>
        <%= @sale.amount %>
      </p>

      <p>
        <strong>Type:</strong>
        <%= @sale.sale_type %>
      </p>

      <% if @sale.Scheduled? %>
        <p>
          <strong>Start time:</strong>
          <%= @sale.start_time %>
        </p>

        <p>
          <strong>End time:</strong>
          <%= @sale.end_time %>
        </p>
      <% end %>

      <p>
        <strong>Target:</strong>
        <%= @sale.sale_target %>
      </p>

      <% if @sale.sale_target == "Specific collections" %>
        <% if @sale.Disabled? %>
          <%= render 'sale_collections/form', sale_collection: @sale_collection %>
        <% end %>
        <% if !@sale_collections.empty? %>
          <table>
            <thead>
              <tr>
                <th>Collections</th>
                <th colspan="1"></th>
              </tr>
            </thead>

            <tbody>
              <% @sale_collections.each do |sale_collection| %>
                <%begin
                    sale_title = ShopifyAPI::CustomCollection.find(sale_collection.collection_id, params: {fields: "title"}).title 
                  rescue
                    begin
                      sale_title = ShopifyAPI::SmartCollection.find(sale_collection.collection_id, params: {fields: "title"}).title
                    rescue
                      sale_collection.destroy
                      sale_title = "This collection does not exist in your shop."
                    end
                  end %>
                <tr>
                  <td><%= sale_title %></td>
                  <td><%= link_to sale_collection, method: :delete, data: { confirm: 'Are you sure?' } do %>
                        <i class="icon-trash"></i>
                      <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>

        <% end %>

      <% elsif @sale.sale_target == "Specific products" %>
        <% if @sale.Disabled? %>
          <%= render 'sale_products/form', sale_product: @sale_product %>
        <% end %>
        <% if !@sale_products.empty? %>
          <table>
            <thead>
              <tr>
                <th>Products</th>
                <th colspan="1"></th>
              </tr>
            </thead>

            <tbody>
              <% @sale_products.each do |sale_product| %>
                <tr>
                  <td><%= ShopifyAPI::Product.find(sale_product.product_id, params: {fields: 'title'}).title %></td>
                  <td><%= link_to sale_product, method: :delete, data: { confirm: 'Are you sure?' } do %>
                        <i class="icon-trash"></i>
                      <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>

        <% end %>
      <% end %>

      <%= link_to 'Edit', edit_sale_path(@sale) %> |
      <%= link_to 'Back', sales_path %>
    </div>
  </article>
</section>