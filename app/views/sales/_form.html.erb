<section>
  <article>
    <%= form_with(model: sale, local: true) do |form| %>
      <% if sale.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(sale.errors.count, "error") %> prohibited this sale from being saved:</h2>

          <ul>
          <% sale.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
          </ul>
        </div>
      <% end %>
      
      <section>
        <aside>
          <h2>Sale Status</h2>
          <p>Enable or disable the sale on your shop. The sale will be activated when you save the changes. If you want to apply sale on specific collections or products, check Deactivate for now and Activate it after you have added the collections or products to your sale.</p>
        </aside>
        <article>
          <div class="card">
            <h5>Status</h5>
            <label><%= form.radio_button :status, "Enabled", onClick: "document.getElementById('schedule').style.display='none';" %> Activate</label>
            <label><%= form.radio_button :status, "Disabled", onClick: "document.getElementById('schedule').style.display='none';" %> Deactivate</label>
            <label><%= form.radio_button :status, "Scheduled", onClick: "document.getElementById('schedule').style.display='block';" %> Schedule</label>
          </div>
        </article>
      </section>

      <section id="schedule" style="display: none;">
        <aside>
          <h2>Sale Schedule</h2>
          <p>Enable or disable the scheduler. This will start and end the sale at given time. Only activated sales which are scheduled will start. Sales that are deactivated will not start on schedule.</p>
        </aside>
        <article>
          <div class="alert notice">
            <dl>
              <dt>Notice Alert</dt>
              <dd>Timezone is UTC.</dd>
            </dl>
          </div>
          <div class="card">
            <h5>Schedule</h5>
            <div class="row side-elements">
              <%= form.label :start_time %>
              <%= form.datetime_select :start_time, min: DateTime.now %>
            </div>
            <div class="row side-elements">
              <%= form.label :end_time %>
              <%= form.datetime_select :end_time, min: DateTime.now %>
            </div>
          </div>
        </article>
      </section>

      <section>
        <aside>
          <h2>Sale Settings</h2>
          <p>Specify the settings of the sale. You can select wether the sale is a percentage discount or a fixed amount off.</p>
        </aside>
        <article>
          <div class="card">
            <h5>Settings</h5>
            <p>Sale title</p>
            <%= form.text_field :title %>
            <br/>
            <div class="row side-elements">
              <label><%= form.radio_button :sale_type, "Percentage" %> Percentage</label>
              <label><%= form.radio_button :sale_type, "Fixed Amount Off" %> Fixed Amount Off</label>
            </div>
            <div class="field">
              <%= form.label :amount %>
              <%= form.number_field :amount %>
            </div>
          </div>
        </article>
      </section>

      <section>
        <aside>
          <h2>Sale target settings</h2>
          <p>Select to apply to products in a collection or to whole store. You can also choose to manually select which products are in the sale.</p>
        </aside>
        <article>
          <div class="card">
            <h5>Behaviour</h5>
            <p>Sale target</p>
            <div class="row side-elements">
              <label><%= form.radio_button :sale_target, 'Whole Store', :checked => true %> Whole Store</label>
              <label><%= form.radio_button :sale_target, 'Specific collections' %> Specific collections</label>
              <label><%= form.radio_button :sale_target, 'Specific products' %> Specific products</label>
            </div>
            <em>You can add collections or products once the sale is created.</em>
          </div>
        </article>
      </section>

      <div class="actions">
        <%= form.submit :onclick => "loading();"%>
      </div>
    <% end %>
  </article>
</section>

<script type="text/javascript">
  (function() {
   if (document.getElementById("sale_status_scheduled").checked){
      document.getElementById('schedule').style.display='block'
    }
  })();
  function loading(){
    setTimeout(function(){ document.getElementById("main_app").innerHTML= "<br/><br/><section><article><div class='card'><h4>Processing request. If you activated or deactivated a sale this might take some time while your sale is being processed on your shop.</h4></div></article></section>"; }, 3000);
  }
</script>